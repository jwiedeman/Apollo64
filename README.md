# Apollo 11 Real-Time Mission Simulator

This repository has been reset to develop a real-time Apollo 11 mission simulator that can run both as a browser-based proof of concept and, eventually, as a Nintendo 64 experience. All design goals and roadmap details live in [`docs/PROJECT_PLAN.md`](docs/PROJECT_PLAN.md), with milestone-specific execution notes collected under [`docs/milestones/`](docs/milestones).

## Repository Layout
- `js/` – Workspace for the JavaScript/Web prototype that will validate the mission model and user experience.
- `n64/` – Workspace for the libdragon-powered Nintendo 64 port that inherits the proven systems from the web build.
- `docs/` – Planning and reference material for the project, including the current mission and technology plan.
- `scripts/ingest/` – Planned notebooks and helper modules that turn annotated research assets into the committed datasets.

## Current Progress
- Milestone M0 datasets now cover launch through splashdown, capturing extended Passive Thermal Control maintenance, MCC-1/2/3/4 PAD workflows, LOI-focused navigation realignments, DOI planning, LM separation, powered descent and landing safing, surface EVA-1 prep/egress/traverse/closeout, ascent/docking evaluation, TEI preparation and execution, transearth DSN communications passes, MCC-5 return corrections, entry PAD alignment, service module jettison, and recovery procedures.
- A new `docs/data/consumables.json` pack records baseline power, propellant, and life-support budgets with citations into the Apollo 11 Mission Operations Report and Flight Plan, enabling simulation modules to initialize realistic resource margins.
- Fresh `docs/data/thrusters.json` geometry maps the CSM and LM reaction-control clusters (radius, angles, translation/torque axes, and thrust/impulse defaults) so Milestone M2 can plug guidance tuning directly into the simulator.
- `docs/data/audio_cues.json` now catalogs buses, categories, and prioritized cues (alerts, callouts, telemetry hints, UI feedback, and ambience) pulled from Apollo 11 transcripts and Mission Operations Report references, and the mission data loader surfaces the pack for upcoming HUD/audio wiring.
- Optional EVA-2 contingency timeline entries, surface science extensions, and DSN signal-strength analytics are now captured in the mission datasets (events, checklists, failures) with provenance in `docs/data/provenance.md` and consolidated telemetry in `docs/data/communications_trends.json`.
- `ResourceSystem` ingests the `communications_trends.json` schedule to track active Deep Space Network passes, apply their power-load deltas, and publish HUD-ready communications summaries (current station, time remaining, and next-window countdowns) for the text HUD and upcoming UI views.
- Milestone M1 CLI prototype in [`js/src/index.js`](js/src/index.js) ingests the mission datasets, drives the deterministic scheduler/resource loop, auto-advances checklist procedures through the `ChecklistManager`, supports scripted manual overrides via `ManualActionQueue`, tracks detailed consumable deltas inside [`ResourceSystem`](js/src/sim/resourceSystem.js), and can export deterministic mission logs for regression playback.
- `ResourceSystem` now converts stage-specific propellant draw into updated Δv margins, logging used vs. recovered m/s totals per SPS and LM stage so the HUD, scoring hooks, and parity harness can reason about long-term maneuvering budgets.
- `ResourceSystem` maintains minute-resolution history buffers for power, thermal, propellant, and communications metrics, exposing `historySnapshot()` for UI trend widgets and optionally attaching the data to HUD frames when `includeResourceHistory` is enabled.
- Resource system architecture, consumables integration, and communications scheduling are now documented in [`docs/sim/resource_system.md`](docs/sim/resource_system.md), aligning mission datasets with Δv planning, failure tracking, and HUD consumers.
- Failure manager inside [`ResourceSystem`](js/src/sim/resourceSystem.js) now records the full taxonomy metadata from `docs/data/failures.csv`, latching classification, trigger, penalty, and recovery guidance with first/last-occurrence GET stamps so the HUD, score system, and upcoming UI fault timeline can surface actionable remediation steps instead of bare failure IDs. Breadcrumb synthesis via [`createFailureBreadcrumb`](js/src/sim/failureBreadcrumbs.js) now attaches cause/effect chains (PTC drift, Δv shortfalls, DSN misses) to each failure entry so HUD panes and mission logs can display actionable context.
- Autopilot runner in [`js/src/sim/autopilotRunner.js`](js/src/sim/autopilotRunner.js) replays mission automation sequences, logs attitude/ullage/throttle commands (now including linear `throttle_ramp` profiles for maneuvers such as LM powered descent), and applies SPS/LM/RCS propellant usage into the shared `ResourceSystem` using propulsion metadata from `docs/data/autopilots.csv` while exposing burn metrics for HUD and scoring hooks; the runtime contract is now fully documented in [`docs/sim/autopilot_runner.md`](docs/sim/autopilot_runner.md).
- Node-based regression tests under [`js/test/`](js/test) now exercise the autopilot throttle integration, manual action queue execution paths, and UI frame summarization so each pass can run `npm test` to verify core mission automation and HUD summaries.
- `EventScheduler` now consumes the detailed burn summaries emitted by the autopilot runner, compares burn time/propellant/Δv against per-script tolerances, and applies mission failure effects when automation drifts out of limits.
- Event scheduler architecture reference in [`docs/sim/event_scheduler.md`](docs/sim/event_scheduler.md) documents timeline gating, checklist/autopilot coordination, failure handling, and telemetry hooks for upcoming UI and analytics work.
- `RcsController` in [`js/src/sim/rcsController.js`](js/src/sim/rcsController.js) ingests the thruster geometry dataset, resolves translation/torque axis pulses, computes propellant mass and impulse totals for new `rcs_pulse` autopilot commands, and feeds usage metrics into the resource system and HUD summaries.
- Commander rating aggregator in [`js/src/sim/scoreSystem.js`](js/src/sim/scoreSystem.js) tracks event completions, resource minima, comms reliability, thermal violations, and manual contributions, producing weighted base scores plus manual bonuses that surface in the CLI summary and parity harness reports.
- Progression roadmap in [`docs/scoring/progression_unlocks.md`](docs/scoring/progression_unlocks.md) maps commander scores, event completion stats, and resource margins into deterministic unlock criteria for alternate missions, challenge variants, and cosmetic rewards.
- Score system regression tests in [`js/test/scoreSystem.test.js`](js/test/scoreSystem.test.js) validate the aggregated event/resource/comms metrics and commander rating outputs so future changes keep the scoring pipeline deterministic.
- Manual vs. auto parity harness in [`js/src/tools/runParityCheck.js`](js/src/tools/runParityCheck.js) replays recorded auto-crew scripts, diffs final event/resource/autopilot states, captures event timeline snapshots for parity comparison, compares filtered mission log streams for frame-level parity, and produces deterministic parity reports to back future regression suites.
- Data validation CLI in [`js/src/tools/validateMissionData.js`](js/src/tools/validateMissionData.js) (`npm run validate:data`) sweeps the mission datasets for GET formatting issues, prerequisite/reference integrity, autopilot asset health (including command payload sanity checks and RCS craft/thruster/tank cross-checks against the thruster geometry and consumables catalogs), PAD parameter JSON validity, consumables budget sanity checks, nested communications metrics, and EVA extension flags.
- Validator coverage now extends to the shared audio cue catalog, checking bus/category IDs, ducking rules, cue durations, cooldowns, and platform asset paths so playback wiring catches schema drift early.
- Mission data validator now ingests the UI definition bundles in `docs/ui/`, ensuring panels, control states, checklist steps, and workspace tiles stay aligned with the mission datasets and surface missing references immediately.
- Milestone M2 planning notes outline guidance, RCS, and docking system requirements in [`docs/milestones/M2_GUIDANCE_RCS.md`](docs/milestones/M2_GUIDANCE_RCS.md) to steer upcoming implementation work.
- Text HUD snapshots generated by [`js/src/hud/textHud.js`](js/src/hud/textHud.js) now surface mission progress, resource margins, propellant usage, T-minus countdowns for upcoming events, active checklist chips, autopilot focus, and caution/warning counts at configurable intervals during CLI runs, aiding long-session monitoring.
- `UiFrameBuilder` in [`js/src/hud/uiFrameBuilder.js`](js/src/hud/uiFrameBuilder.js) consolidates scheduler, resource, autopilot, checklist, and manual queue state into deterministic `ui_frame` snapshots (documented in [`docs/ui/ui_frame_reference.md`](docs/ui/ui_frame_reference.md)) so the CLI HUD and upcoming Navigation/Controls/Systems views share a single data contract.
- UI frame exporter in [`js/src/tools/exportUiFrames.js`](js/src/tools/exportUiFrames.js) now forwards the score system so recorded frames include commander rating snapshots alongside the rest of the HUD payload for UI prototyping and regression fixtures.
- UI frame export harness in [`js/src/tools/exportUiFrames.js`](js/src/tools/exportUiFrames.js) captures deterministic `ui_frame` sequences (metadata + frames) for UI prototyping, accessibility reviews, and regression fixtures aligned with the documented schema.
- Autopilot burn analyzer in [`js/src/tools/analyzeAutopilots.js`](js/src/tools/analyzeAutopilots.js) replays mission slices to compare actual vs. expected burn durations, propellant draw, Δv deltas, and PAD metadata, exiting non-zero when autopilot events fail tolerance checks to keep guidance tuning honest.
- Two-body orbit propagator in [`js/src/sim/orbitPropagator.js`](js/src/sim/orbitPropagator.js) advances the spacecraft state with RK4 integration, records periapsis/apoapsis metrics, tracks applied Δv impulses from autopilot summaries, and supplies `UiFrameBuilder`/HUD consumers with trajectory summaries and history samples for the Navigation view; the architecture and telemetry contract are documented in [`docs/sim/orbit_propagator.md`](docs/sim/orbit_propagator.md).
- Mission log aggregator in [`js/src/logging/missionLogAggregator.js`](js/src/logging/missionLogAggregator.js) normalizes mission logger output into categorized, severity-tagged streams, feeding `UiFrameBuilder` frames, CLI summaries, and export packages with deterministic console data for UI overlays and parity tooling.
- Mission logging emitters across the simulator now attach explicit `logCategory`, `logSeverity`, and `logSource` metadata so downstream HUD, export, and parity consumers operate on pre-classified entries instead of relying on message heuristics.
- Dedicated mission log reference in [`docs/logging/mission_log_reference.md`](docs/logging/mission_log_reference.md) documents the logger/aggregator data contract so CLI runs, HUD snapshots, and parity tooling share the same metadata-rich console feed.
- Input mapping blueprint in [`docs/ui/input_mappings.md`](docs/ui/input_mappings.md) locks in deterministic keyboard, gamepad, and N64 controller bindings, tying each interaction to mission data contracts (`ui_frame`, `panels.json`, `ManualActionQueue`) so future UI work preserves checklist fidelity across platforms.
- Workspace preset pack in [`docs/ui/workspaces.json`](docs/ui/workspaces.json) defines the Navigation, Docking Ops, Systems Night Watch, and Entry Corridor tile layouts described in the HUD specification so the UI layer can load consistent pane arrangements across web and N64 builds.
- Panel definition pack in [`docs/ui/panels.json`](docs/ui/panels.json) enumerates the Flight Control, RCS, power, comms, circuit breaker, and LM panel topologies with control metadata so the upcoming UI can highlight dependencies, telemetry hooks, and caution triggers directly from mission truth.
- Checklist prototype bundle in [`docs/ui/checklists.json`](docs/ui/checklists.json) captures high-priority procedures (TLI prep, PTC establishment, LOI config, LM separation, final approach, TEI config) using the new `panels.json` identifiers and DSKY macros to prove the data contract ahead of the interactive build.
- Milestone M3 UI, HUD, and audio telemetry planning in [`docs/milestones/M3_UI_AUDIO.md`](docs/milestones/M3_UI_AUDIO.md) defines presentation-layer architecture, cue taxonomy, and accessibility handoff targets for the JS prototype and N64 port.
- Detailed HUD and pane layout specification in [`docs/ui/hud_layout.md`](docs/ui/hud_layout.md) locks in the Always-On HUD modules, Navigation/Controls/Systems view grids, tile-mode presets, and data-binding strategy that the M3 UI build will implement across the web and N64 targets.
- Commander rating integration in [`docs/ui/hud_layout.md`](docs/ui/hud_layout.md), [`docs/ui/view_data_bindings.md`](docs/ui/view_data_bindings.md), and [`docs/ui/workspaces.json`](docs/ui/workspaces.json) adds the Always-On score capsule, Systems view scorecard, and tile-mode placements wired to the `UiFrameBuilder` `score` block so mission health trends surface alongside resource telemetry.
- UI component architecture blueprint in [`docs/ui/component_architecture.md`](docs/ui/component_architecture.md) maps the pane/component tree, `ui_frame` ingestion flow, tile workspace persistence, and accessibility hooks that keep the Always-On HUD authoritative across web and N64 builds.
- Audio cue taxonomy and routing plan in [`docs/ui/audio_cue_taxonomy.md`](docs/ui/audio_cue_taxonomy.md) defines cue categories, priority/ducking rules, dataset hooks, and asset specs so the upcoming dispatcher can balance alerts, callouts, ambience, and UI feedback consistently.
- Audio dispatcher architecture blueprint in [`docs/ui/audio_dispatcher_architecture.md`](docs/ui/audio_dispatcher_architecture.md) maps the binder, priority queues, mixer abstraction, logging hooks, and testing roadmap that will turn the cue catalog into deterministic playback across the web prototype and N64 port.
- Logging, replay, and accessibility guidance in [`docs/ui/logging_accessibility_guidelines.md`](docs/ui/logging_accessibility_guidelines.md) aligns mission logging, replay exports, caption overlays, high-contrast modes, and input remapping so the M3 presentation layer remains deterministic and inclusive across web and N64 builds.
- Rendezvous and docking overlay specification in [`docs/ui/rendezvous_overlay.md`](docs/ui/rendezvous_overlay.md) defines activation triggers, layout regions, telemetry bindings, and accessibility hooks so the Navigation and Controls panes can present authentic braking gates, docking reticles, and RCS budget cues in lockstep with Milestones M2 and M3.
- Milestone M4 N64 port plan in [`docs/milestones/M4_N64_PORT.md`](docs/milestones/M4_N64_PORT.md) maps the libdragon architecture, rendering/audio budgets, input scheme, and asset pipeline for the hardware build.
- Milestone M5 content integration roadmap in [`docs/milestones/M5_CONTENT_PASS.md`](docs/milestones/M5_CONTENT_PASS.md) itemizes the remaining dataset ingestion work, contingency branches, and ingestion tooling required for the full mission graph.
- Milestone M6 fidelity pass outline in [`docs/milestones/M6_FIDELITY_PASS.md`](docs/milestones/M6_FIDELITY_PASS.md) defines calibration targets for timelines, propulsion, resources, and communications against Apollo 11 telemetry.
- Milestone M7 stability plan in [`docs/milestones/M7_STABILITY_FAULTS.md`](docs/milestones/M7_STABILITY_FAULTS.md) details soak-testing strategy, fault injection coverage, and automation expectations for release readiness.
- Manual action recorder in [`js/src/logging/manualActionRecorder.js`](js/src/logging/manualActionRecorder.js) can capture auto-advanced checklist steps and export them via the CLI `--record-manual-script` flag for deterministic manual-vs-auto parity runs.
- `ManualActionQueue` now accepts `dsky_entry` actions so scripted runs and future UI flows can log Verb/Noun inputs and macro payloads for AGC integration while keeping the mission log authoritative.
- `AutopilotRunner` now interprets `dsky_entry` commands, logging Verb/Noun payloads and forwarding them to the manual action recorder so recorded scripts retain AGC macro usage for parity replays and UI prototypes.
- Manual interaction contract documented in [`docs/ui/manual_actions_reference.md`](docs/ui/manual_actions_reference.md) so the upcoming UI dispatcher, parity tooling, and ingestion notebooks share a single source of truth for queueing checklist acknowledgements, resource deltas, propellant burns, and DSKY macros.
- Autopilot authoring reference in [`docs/data/autopilot_scripts.md`](docs/data/autopilot_scripts.md) details the CSV/JSON schema, command vocabulary, propulsion metadata, and validation workflow so new burn profiles stay aligned with the simulator and parity harness.
- Ingestion workflow planning under [`scripts/ingest/`](scripts/ingest/README.md) and [`docs/data/INGESTION_PIPELINE.md`](docs/data/INGESTION_PIPELINE.md) now documents how future dataset updates move from annotated sources into the CSV/JSON packs, including notebook sequencing, validation checkpoints, and automation hooks.
- Shared Python helpers under [`scripts/ingest/ingestlib/`](scripts/ingest/ingestlib) expose GET utilities, typed dataset loaders, validation routines, and provenance table builders so notebooks and future automation reuse a single source of truth.

## Immediate Priorities
1. Continue Milestone M0 by publishing ingestion notebooks under `scripts/ingest/`, rounding out contingency datasets, and wiring the new EVA/DSN analytics into automated regression notebooks while extending the validation CLI as new schema fields appear.
2. Integrate the new manual/auto parity harness (`npm run parity`) into routine regression workflows, now leveraging log-stream comparisons alongside event/resource/autopilot diffs, while continuing autopilot burn calibration (verifying mass-flow assumptions against mission data) and expanding deterministic replay suites that exercise the manual action queue and resource deltas.
3. Prepare for Milestone M2 execution by deriving thruster configuration tables, validating autopilot script needs, and planning rendezvous tuning sessions following [`docs/milestones/M2_GUIDANCE_RCS.md`](docs/milestones/M2_GUIDANCE_RCS.md).
4. Capture Milestone M3 presentation-layer requirements by prototyping HUD layouts, audio cue routing, and accessibility tooling as described in [`docs/milestones/M3_UI_AUDIO.md`](docs/milestones/M3_UI_AUDIO.md).

## Documentation Map
- [`docs/PROJECT_PLAN.md`](docs/PROJECT_PLAN.md) – High-level scope, pillars, and mission milestones.
- [`docs/milestones/M0_DATA_INGESTION.md`](docs/milestones/M0_DATA_INGESTION.md) – Historical data ingestion workflow and schemas.
- [`docs/milestones/M1_CORE_SYSTEMS.md`](docs/milestones/M1_CORE_SYSTEMS.md) – Core engine, scheduler, and Passive Thermal Control specification.
- [`docs/milestones/M2_GUIDANCE_RCS.md`](docs/milestones/M2_GUIDANCE_RCS.md) – Guidance execution, RCS modelling, and docking gameplay plan.
- [`docs/milestones/M3_UI_AUDIO.md`](docs/milestones/M3_UI_AUDIO.md) – UI, HUD, audio telemetry, and accessibility planning for the prototype and N64 targets.
- [`docs/milestones/M4_N64_PORT.md`](docs/milestones/M4_N64_PORT.md) – N64 port architecture, performance validation plan, and Controller Pak integration roadmap.
- [`docs/milestones/M5_CONTENT_PASS.md`](docs/milestones/M5_CONTENT_PASS.md) – Complete mission dataset integration, contingency coverage, and ingest tooling roadmap.
- [`docs/milestones/M6_FIDELITY_PASS.md`](docs/milestones/M6_FIDELITY_PASS.md) – Calibration plan for timelines, resources, and communications fidelity.
- [`docs/milestones/M7_STABILITY_FAULTS.md`](docs/milestones/M7_STABILITY_FAULTS.md) – Stability, fault injection, soak testing, and automation strategy.
- [`docs/data/README.md`](docs/data/README.md) – Normalized mission datasets produced during Milestone M0 (currently covering launch through splashdown).
- [`docs/data/VALIDATION_CHECKS.md`](docs/data/VALIDATION_CHECKS.md) – Automated dataset sweep coverage and guidance for extending the validation CLI.
- [`docs/data/INGESTION_PIPELINE.md`](docs/data/INGESTION_PIPELINE.md) – Step-by-step workflow for running the ingestion notebooks, validating outputs, and planning future automation.
- [`docs/data/pads_reference.md`](docs/data/pads_reference.md) – Column definitions, parameter payload schema, and integration notes for the mission PAD dataset consumed by events, HUD bindings, and validation tooling.
- [`docs/ui/AGENTS.md`](docs/ui/AGENTS.md) – Front-end layout, interaction, and workspace guidelines for the Milestone M3 UI build.
- [`docs/ui/panel_hierarchy.md`](docs/ui/panel_hierarchy.md) – Mission panel inventory with control states, checklist links, and simulation notes for CSM/LM stations.
- [`docs/ui/dsky_reference.md`](docs/ui/dsky_reference.md) – DSKY macro catalog covering alignment, burn, docking, and entry Verb/Noun pairs with prerequisite logic.
- [`docs/ui/json_schemas.md`](docs/ui/json_schemas.md) – JSON schema definitions for upcoming checklist, panel, and workspace data packs consumed by the UI layer.
- [`docs/ui/workspaces.json`](docs/ui/workspaces.json) – Authoritative Navigation, Docking, Systems, and Entry workspace presets that adhere to the HUD and tile-mode layout specification.
- [`docs/ui/panels.json`](docs/ui/panels.json) – Structured inventory of CSM/LM panels, control states, dependencies, and alert triggers consumed by the UI layer.
- [`docs/ui/checklists.json`](docs/ui/checklists.json) – Structured checklist steps referencing panel controls, prerequisites, and DSKY macros for the prototype mission slices.
- [`docs/ui/hud_layout.md`](docs/ui/hud_layout.md) – HUD band, pane layouts, tile-mode presets, and accessibility hooks for the Milestone M3 presentation layer.
- [`docs/ui/component_architecture.md`](docs/ui/component_architecture.md) – Component tree, frame ingestion pipeline, tile workspace behavior, and accessibility hooks for the web/N64 UI builds.
- [`docs/ui/view_data_bindings.md`](docs/ui/view_data_bindings.md) – Detailed data-binding catalog covering the Always-On HUD, Navigation, Controls, Systems, and Tile Mode widgets so implementation stays anchored to mission truth.
- [`docs/ui/audio_cue_taxonomy.md`](docs/ui/audio_cue_taxonomy.md) – Cue categories, priority routing, dataset integration, and asset specs for the mission audio pipeline.
- [`docs/ui/audio_dispatcher_architecture.md`](docs/ui/audio_dispatcher_architecture.md) – Runtime binder, queueing, mixing, and validation plan that will drive deterministic audio playback across web and N64 builds.
- [`docs/ui/rendezvous_overlay.md`](docs/ui/rendezvous_overlay.md) – Navigation/Controls overlay blueprint covering braking gates, docking reticle cues, telemetry bindings, and accessibility behaviors for the rendezvous phase.
- [`docs/ui/logging_accessibility_guidelines.md`](docs/ui/logging_accessibility_guidelines.md) – Deterministic logging contract, replay export pipeline, and accessibility baselines (color, captioning, input remapping) for the presentation layer.
- [`docs/sim/autopilot_runner.md`](docs/sim/autopilot_runner.md) – Autopilot script execution loop, command integrations, telemetry exports, and tolerance handling.
- [`docs/sim/event_scheduler.md`](docs/sim/event_scheduler.md) – Mission timeline control, checklist/autopilot integration, tolerance enforcement, and telemetry hooks.
- [`docs/sim/orbit_propagator.md`](docs/sim/orbit_propagator.md) – Orbit propagator architecture, Δv impulse tracking, and HUD/telemetry integration.
- [`docs/sim/resource_system.md`](docs/sim/resource_system.md) – Resource system responsibilities, consumables budgets, Δv accounting, communications scheduling, and failure integration.
- [`docs/logging/mission_log_reference.md`](docs/logging/mission_log_reference.md) – Logger and aggregator architecture reference that keeps CLI, HUD, parity harnesses, and exports aligned on mission log structure.
- [`docs/ui/manual_actions_reference.md`](docs/ui/manual_actions_reference.md) – Runtime contract for enqueuing manual checklist acknowledgements, resource deltas, propellant burns, and DSKY macros from the UI or parity tooling.
- [`docs/scoring/commander_rating.md`](docs/scoring/commander_rating.md) – Commander rating model, telemetry inputs, and weighting used by the simulation score system.
- [`docs/scoring/progression_unlocks.md`](docs/scoring/progression_unlocks.md) – Progression/unlock plan translating score summaries into campaign, challenge, and cosmetic rewards across platforms.
- [`docs/testing/REGRESSION_PLAN.md`](docs/testing/REGRESSION_PLAN.md) – Regression workflow covering dataset validation, parity harness runs, autopilot analysis, and HUD frame exports.

## Contribution Notes
- Follow the guidelines in [`AGENTS.md`](AGENTS.md) for documentation structure and future implementation phases.
- Run `npm test` inside `js/` to execute the automated regression suite before submitting changes.
- Document any manual verification performed until automated tests are introduced.
