# UI View Data Binding Catalog

This catalog translates the high-level layout plans into concrete data
requirements for each widget across the Always-On HUD, Navigation,
Controls, Systems, and Tile views. It assumes the simulator emits
`ui_frame` snapshots via [`UiFrameBuilder`](ui_frame_reference.md) and
publishes supplemental feeds (attitude quaternions, trajectory samples,
resource history buffers) on the shared mission event bus described in
[`component_architecture.md`](component_architecture.md).

The goal is to keep every interaction grounded in the mission
checklists, autopilot scripts, and resource models defined elsewhere in
the project plan so implementation work can wire UI components to the
proper truth sources without guesswork.

## Data Sources at a Glance

| Source | Scope | Notes |
| --- | --- | --- |
| `ui_frame` (builder output) | Core mission snapshot | Provides time, event counts, upcoming windows, resource margins, checklist summaries, autopilot stats, manual queue status, and alert lists. Refresh cadence defaults to the HUD interval (600 s in CLI, 1–5 s in interactive builds). |
| `attitudeStream` | Orientation quaternions, body rates | Produced by the guidance loop at simulation tick rate (20 Hz). Consumed by the navball, PTC ring, and docking overlay. |
| `trajectoryStream` | Patched-conic samples, maneuver nodes | Generated by the mission scheduler and guidance solver when burns are planned or executed. Navigation view samples at 1 Hz, interpolates between points for smooth rendering. |
| `resourceHistory` | Rolling buffers (power, cryo, propellant, comms) | Maintained by `ResourceSystem` (see `historySnapshot()`). Available via `frame.resourceHistory` when the builder enables it or by calling `resourceSystem.historySnapshot()` directly. Systems view trend widgets subscribe to requested channels. |
| `missionLog` | Event/console feed | Combines scheduler, autopilot, manual queue, audio dispatcher, and failure breadcrumbs. Console dock filters by category. |
| `panelState` | Switch positions, breaker states | Derived from checklist manager + manual queue actions. Controls view schematics highlight active vs. required positions. |
| `workspaceStore` | Tile/workspace presets (`workspaces.json`) | Provides layout metadata and user overrides. |

All widgets consume `ui_frame` first. Supplemental feeds fill gaps that
the frame intentionally omits for bandwidth (e.g., full trajectory
vectors, high-frequency attitude data).

## Always-On HUD Bindings

| Widget | Primary Data | Secondary Data | Update Notes | Interactions |
| --- | --- | --- | --- | --- |
| Time & Event Block | `frame.time`, `frame.events.next` | `missionLog` (for pause/resume notices) | Countdown label interpolates between frames every render tick; falls back to `frame.events.upcoming[0]` when `next` missing. | Click jumps Navigation view to focused event (timeline ribbon scroll + checklist highlight). |
| Maneuver Summary | `frame.autopilot.primary`, `frame.resources.deltaV` | `trajectoryStream` (node metadata), `missionLog` (burn start/stop) | Shows stage-specific Δv remaining vs. target and throttle state using `deltaV.stages` + `deltaV.primaryStageId`. When autopilot idle, displays `PTC` status from `frame.resources.thermal`. | Click toggles Navigation burn overlay or, if manual mode, opens Controls view DSKY with `Plan Burn` macros queued. |
| Resource Strip | `frame.resources.power`, `frame.resources.propellant.tanks`, `frame.resources.thermal` | `resourceHistory` (sparklines for tooltip) | Gauges lerp between frames for smoothness. Thresholds pulled from builder options. | Clicking gauge routes to Systems view module; caution states flash until acknowledged in Systems view or resource recovers. |
| Checklist Chip | `frame.checklists.chip` | `frame.manualQueue` (for manual override indicator) | Shows active checklist ID/title and steps remaining. | Click toggles Controls view checklist lane focus; long press (controller `Hold A`) opens manual queue inspector. |
| Comms / Alert Lamps | `frame.resources.communications`, `frame.alerts` | `audio dispatcher` (for cue status) | Lamp color mirrors warning/caution/failure state. DSN icon pulses when next pass within 15 minutes. | Clicking DSN lamp opens Systems view comms tracker; clicking master alarm silences audio cue while leaving failure latched. |
| Score Chip | `frame.score.rating`, `frame.score.events`, `frame.score.manual` | `missionLog` (grade acknowledgement entries) | Displays commander score, grade badge, and manual bonus meter. Tooltip breaks down event completion and manual fraction. | Click jumps to Systems view scorecard tile; holding controller confirm key logs “grade reviewed” entry. |
| PTC Indicator | `frame.resources.thermal`, `frame.autopilot.primary` | `attitudeStream` (roll rate) | Outer ring animates roll rate target; interior icon shows comm link strength from communications slice. | Click focuses Navigation navball and toggles roll-rate overlay. |

## Navigation View Bindings

| Widget | Data Inputs | Derived Fields | Interactions |
| --- | --- | --- | --- |
| Trajectory Canvas | `trajectoryStream` samples, `frame.trajectory`, `frame.events.upcoming`, `frame.resources.communications.current` | Future burn arcs (Δv/time from autopilot metadata), comm cones (station + signal strength), entry corridor bands, and current altitude/periapsis/apoapsis markers sourced from `frame.trajectory`. | Clicking maneuver node selects event, loads PAD parameters into DSKY preview, arms relevant checklist. Dragging timeline scrubber preview (no time warp) updates callout tooltip without mutating simulation time. |
| Navball | `attitudeStream`, `frame.autopilot.activeAutopilots`, `frame.resources.thermal.ptcActive` | PTC ring color (stable/trim), docking overlay (range/rate from `trajectoryStream` rendezvous nodes). | Clicking toggles AGC vs. SCS reference (updates Controls view SCS panel highlight). Holding controller bumper engages temporary fine-rate view (zooms ±10° window). |
| State Vector Panel | `frame.trajectory`, `frame.resources.deltaV`, `frame.autopilot.primary`, PAD metadata (`pads.csv` entry referenced by active event) | Displays live GET, altitude, velocity, periapsis/apoapsis, period, and Δv residuals. Highlights tolerance breaches from `autopilot.primary` and autopilot Δv metrics. | Copy button writes PAD to clipboard/Controller Pak log. `Plan Burn` opens DSKY macros `V21N33` + `V21N38` pre-filled with PAD values. |
| Timeline Ribbon | `frame.events.upcoming`, `missionLog` (completed events), `frame.resources.communications` | Icons differentiate burn, comm window, checklist, failure recovery. Colors reflect status (pending/active/complete/failed). | Clicking marker re-centers ribbon, scrolls checklist lane, queues audio callout preview. Keyboard/controller left/right iterate markers; `Enter` executes same focus as click. |
| Console Dock (Nav filter) | `missionLog` filtered to Navigation category | Adds inline chips linking to relevant panels/events. | Filter chips toggle categories (Events/Autopilot/Audio). Search field jumps to matching log entries and highlights corresponding timeline markers. |
| Burn Overlay | `frame.autopilot.primary`, `trajectoryStream` (target vector), `attitudeStream` (current pointing) | Shows throttle bar, Δv achieved, attitude error needles. | Manual throttle slider (debug mode) emits manual queue `propellant_burn` actions while autopilot disabled. |

## Controls View Bindings

| Widget | Data Inputs | Derived Fields | Interactions |
| --- | --- | --- | --- |
| Panel List | `panels.json`, `frame.checklists.active`, `panelState` | Badges display outstanding checklist references per panel; caution icon if associated breaker open (`frame.alerts`). | Selecting item scrolls to first highlighted control; keyboard/controller hotkeys map to list index. |
| Panel Diagram | `panels.json` layout, `panelState`, `frame.checklists.active` | Highlights controls referenced by current checklist step; dependency lines animate when prerequisites missing. | Clicking toggles control -> dispatches manual action to simulation. Tooltips show GET of last change (from `missionLog`). |
| DSKY Module | `frame.checklists.chip`, `dsky_reference`, `frame.autopilot.primary`, `missionLog` for AGC status | Macro tray shows applicable Verb/Noun combos with prerequisites resolved (`panels.json` dependencies). Display registers update using upcoming AGC integration (placeholder values from autopilot). | Pressing macro button queues manual action; invalid state triggers warning toast + audio cue from taxonomy plan. Numeric keypad inputs feed manual queue `dsky_entry` actions (to be integrated with AGC loop). |
| Checklist Lane | `frame.checklists.active`, `frame.manualQueue` | Step cards show status, assigned crew role, DSKY/panel references. Auto-advance indicator pulses when simulator about to acknowledge next step. | `Enter`/controller `A` acknowledges step (manual queue action). `Space` or `Do Next` button jumps to recommended panel/macro. |
| Manual Action Monitor | `frame.manualQueue`, `missionLog` | Visual timeline of pending manual actions with GET countdown. | Developer toggle can pause/resume queue; failure icons open log detail for debugging parity mismatches. |

## Systems View Bindings

| Widget | Data Inputs | Derived Fields | Interactions |
| --- | --- | --- | --- |
| Power Grid | `frame.resources.power`, `resourceHistory.power`, `panelState` (breaker status) | Animates flow arrows proportional to kW draw. Alerts highlight buses outside thresholds. | Clicking component opens Controls view Electrical Power or Circuit Breaker panel. Hover reveals last 30 min trend via sparkline. |
| Propellant Deck | `frame.resources.propellant.tanks`, `frame.autopilot.propellantKgByTank`, `resourceHistory.propellant` | Shows percent remaining, kg totals, burn history. Reserve threshold shading derived from budgets. | Toggle switches between % and kg. Selecting tank pins history overlay; `Export` button dumps JSON slice for debugging. |
| Thermal Panel | `frame.resources.thermal`, `resourceHistory.thermal`, `missionLog` (thermal faults) | Graph overlays PTC state transitions, cryo boiloff, glycol pump states. | Range selector chooses 30 min / 2 hr / mission window. Clicking PTC badge toggles manual queue action to adjust PTC mode (future autopilot tie-in). |
| Comms Tracker | `frame.resources.communications.current/next`, `resourceHistory.communications`, `missionLog` (PAD deliveries) | Visual timeline of DSN passes, current station, handover countdown. | `Remind` button pins upcoming pass chip to Always-On HUD. Conflict warnings highlight overlapping burns; clicking opens timeline ribbon at conflict event. |
| Commander Scorecard | `frame.score`, `resourceHistory` (optional power/Δv minima) | Aggregates commander score (events/resources/faults/manual) with grade badge, manual fraction meter, and trend sparklines. | “View details” opens modal listing contributing events and resource minima; acknowledge button logs console entry. |
| Trends & Fault Log | `missionLog` (failure breadcrumbs), `frame.alerts.failures`, `resourceHistory` metrics | Entries include classification, trigger text, first/last GET, cause chain, and recommended checklist. | Filters by subsystem; selecting entry jumps to associated panel/checklist and logs ack in mission log. |

## Tile Mode & Workspace Bindings

| Element | Data Inputs | Notes |
| --- | --- | --- |
| Tile Presets | `workspaces.json`, `workspaceStore` | Presets validated against component availability; loader warns if widget missing (e.g., N64 entry overlay disabled until implemented). |
| Drag/Resize Manager | `workspaceStore` | Emits layout updates serialized back to JSON. Snap grid and focus behavior follow `hud_layout.md`. |
| Focus Mode | Any widget | In focus, widgets still consume same data slices but request higher-frequency updates where available (e.g., navball subscribes to 10 Hz attitude). |

## Implementation Checklist

1. **Frame Subscription:** Build a shared hook/service that exposes the
   latest `ui_frame` plus helper selectors (e.g., `useUpcomingEvents()`).
2. **Supplemental Streams:** Register view-level subscriptions to the
   high-frequency feeds (`attitudeStream`, `trajectoryStream`,
   `resourceHistory`) only when widgets requiring them are mounted to
   minimize overhead.
3. **Action Dispatch:** Route UI interactions to the simulation input bus
   mirroring `ManualActionQueue` semantics so manual/auto parity tooling
   remains valid. Log every dispatched action through `missionLog` with
   a `source: 'ui'` tag.
4. **Alert Acknowledgement:** Clearing warnings/cautions requires the UI
   to emit explicit acknowledgement actions. Systems view should surface
   a "Mark Reviewed" control that logs the acknowledgement and dims the
   HUD lamp until the underlying resource leaves the caution band.
5. **Recording Hooks:** The manual action recorder should capture UI
   interactions (panel toggles, DSKY macros, workspace changes) so
   parity runs can replay them. Coordinate event names with
   `runParityCheck.js` ignore lists where appropriate.

This binding catalog keeps the UI grounded in the simulator's deterministic
state while mapping each widget to the precise data it needs. With these
references, developers can proceed from layout mockups to functioning
components confident that every interaction honors the Apollo
procedures captured throughout the project plan.
